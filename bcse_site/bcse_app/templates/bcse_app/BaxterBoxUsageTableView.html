{% load bcse_extras %}
<table class="table table-bordered table-striped" id="baxter_box_usage_report">
  <thead>
    <tr class="noExl">
      <th colspan="4">From</th>
      <th colspan="4">To</th>
    </tr>
  </thead>
  <tbody>
    <tr style="display:none;">
      <td colspan="4" style="background-color: #767676; color: white;">From</td>
      <td colspan="4" style="background-color: #767676; color: white;">To</td>
    </tr>
    <tr>
      <td colspan="4">
        {% if from_date %}
          {{from_date|date:"F j, Y"}}
        {% else %}
          Any
        {% endif %}
      </td>
      <td colspan="4">
        {% if to_date %}
          {{to_date|date:"F j, Y"}}
        {% else %}
          Any
        {% endif %}
      </td>
      <tr>
        <td colspan="8"></td>
      </tr>
    </tr>
  </tbody>
  <thead>
    <tr class="noExl">
      <th> Equipment</th>
      <th> Unit Cost ($)</th>
      <th> # of Reservation </th>
      <th> Total Cost ($)</th>
      <th> # of Unique Teachers </th>
      <th> # of Unique Schools </th>
      <th> # of Classes </th>
      <th> # of Students </th>
    </tr>
  </thead>
  <tbody>
    <tr style="display:none;">
      <td style="background-color: #767676; color: white;"> Equipment</td>
      <td style="background-color: #767676; color: white;"> Unit Cost ($)</td>
      <td style="background-color: #767676; color: white;"> # of Reservation </td>
      <td style="background-color: #767676; color: white;"> Total Cost ($)</td>
      <td style="background-color: #767676; color: white;"> # of Unique Teachers </td>
      <td style="background-color: #767676; color: white;"> # of Unique Schools </td>
      <th style="background-color: #767676; color: white;"> # of Classes </th>
      <th style="background-color: #767676; color: white;"> # of Students </th>
    </tr>
    {% for id, equipment in equipment_usage.items %}
      <tr>
        <td>{{equipment.name}}</td>
        <td>{{equipment.unit_cost|floatformat:2|default_if_none:""}}</td>
        <td>{{equipment.reservations|length}}</td>
        <td>
            {% if equipment.reservations|length > 0 and equipment.unit_cost > 0 %}
              {{equipment.reservations|length|multiply:equipment.unit_cost|floatformat:2}}
            {% endif %}
        </td>
        <td>{{equipment.teachers|length}}</td>
        <td>{{equipment.schools|length}}</td>
        <td>{{equipment.classes}}</td>
        <td>{{equipment.students}}</td>
      </tr>
    {% endfor %}
    <tr>
      <td colspan="4"></td>
    </tr>
  </tbody>
  <thead>
    <tr class="noExl">
      <th> Consumable Kit</th>
      <th> Unit Cost ($)</th>
      <th> Usage Count </th>
      <th> Total Cost ($)</th>
      <th> # of Unique Teachers </th>
      <th> # of Unique Schools </th>
      <th> # of Classes </th>
      <th> # of Students </th>
    </tr>
  </thead>
  <tbody>
    <tr style="display:none;">
      <td style="background-color: #767676; color: white;"> Consumable Kit</td>
      <td style="background-color: #767676; color: white;"> Unit Cost ($)</td>
      <td style="background-color: #767676; color: white;"> Usage Count </td>
      <td style="background-color: #767676; color: white;"> Total Cost ($)</td>
      <td style="background-color: #767676; color: white;"> # of Unique Teachers </td>
      <td style="background-color: #767676; color: white;"> # of Unique Schools </td>
      <th style="background-color: #767676; color: white;"> # of Classes </th>
      <th style="background-color: #767676; color: white;"> # of Students </th>
    </tr>
    {% for id, kit in kit_usage.items %}
      <tr>
        <td>{{kit.name}}</td>
        <td>{{kit.unit_cost|floatformat:2|default_if_none:""}}</td>
        <td>{{kit.count}}</td>
        <td>
          {% if kit.count > 0 and kit.unit_cost > 0 %}
            {{kit.count|multiply:kit.unit_cost|floatformat:2}}
          {% endif %}
        </td>
        <td>{{kit.teachers|length}}</td>
        <td>{{kit.schools|length}}</td>
        <td>{{kit.classes}}</td>
        <td>{{kit.students}}</td>
      </tr>
    {% endfor %}
    <tr>
      <td colspan="8"></td>
    </tr>
  </tbody>
  <thead>
    <tr class="noExl">
      <th> Total # of Reservations </th>
      <th> Total Equipment Cost ($)</th>
      <th> Total # of Kits Used </th>
      <th> Total Kit Cost ($)</th>
      <th> Total # of Unique Teachers </th>
      <th> Total # of Unique Schools </th>
      <th> Total # of Classes </th>
      <th> Total # of Students </th>
    </tr>
  </thead>
  <tbody>
    <tr style="display:none;">
      <td style="background-color: #767676; color: white;"> Total # of Reservations</td>
      <td style="background-color: #767676; color: white;"> Total Equipment Cost </td>
      <td style="background-color: #767676; color: white;"> Total # of Kits Used</td>
      <td style="background-color: #767676; color: white;"> Total Kit Cost </td>
      <td style="background-color: #767676; color: white;"> Total # of Unique Teachers </td>
      <td style="background-color: #767676; color: white;"> Total # of Unique Schools </td>
      <th style="background-color: #767676; color: white;"> Total # of Classes </th>
      <th style="background-color: #767676; color: white;"> Total # of Students </th>
    </tr>
    <tr>
      <td>{{total_usage.reservations}}</td>
      <td>{{total_usage.total_equipment_cost|floatformat:2}}</td>
      <td>{{total_usage.kits}}</td>
      <td>{{total_usage.total_kit_cost|floatformat:2}}</td>
      <td>{{total_usage.teachers|length}}</td>
      <td>{{total_usage.schools|length}}</td>
      <td>{{total_usage.classes}}</td>
      <td>{{total_usage.students}}</td>
    </tr>
  </tbody>
</table>
