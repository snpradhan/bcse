<div class="modal-dialog modal-lg">
  <div class="modal-content">
    <div class="modal-header">
      {% if form.instance.id %}
      <h3 class="left"> {{form.instance.name}} </h3>
      {% else %}
      <h3 class="left"> Create Giveaway </h3>
      {% endif %}
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div id="giveawayMsg" class="msg">
      <ul class="errorlist">
        {% for message in messages %}
        <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|safe }}</li>
        {% endfor %}
      </ul>
    </div>
    <form class="form" id="formGiveaway" enctype="multipart/form-data" method="post" action="{% if form.instance.id %}{% url 'bcse:giveawayEdit' form.instance.id %} {% else %} {% url 'bcse:giveawayNew' %}{% endif %}" >
      {% csrf_token %}
      {{form.media}}
      {{form.management_form}}
      <div class="modal-body">

        <div class="form-group mb-3">
          <label for="id_{{form.name.name}}" class="form-label">
            {{ form.name.label }}
            {% if form.name.field.required %}
              (<span class="required">*</span>)
            {% endif %}
          </label>
          <div>{{form.name}}</div>
          <div class="error">{{ form.name.errors }}</div>
        </div>
        <div class="form-group mb-3">
          <label for="id_{{form.description.name}}" class="form-label">
            {{ form.description.label }}
            {% if form.description.field.required %}
              (<span class="required">*</span>)
            {% endif %}
          </label>
          <div>{{form.description}}</div>
          <div class="error">{{ form.description.errors }}</div>
        </div>
        <div class="form-group mb-3">
          <label for="id_{{form.image.name}}" class="form-label">
            {{ form.image.label }}
            {% if form.image.field.required %}
              (<span class="required">*</span>)
            {% endif %}
          </label>
          {% if form.instance.id and form.instance.image.url %}
            <div class="image_preview">
              <img src="{{form.instance.image.url}}" class="icon" alt="">
            </div>
          {% endif %}
          <div>{{form.image}}</div>
          <div class="error">{{ form.image.errors }}</div>
        </div>
        <div class="row mb-3">
          <div class="form-group col-md-6">
            <label for="id_{{form.max_quantity_allowed.name}}" class="form-label">
              {{ form.max_quantity_allowed.label|title }}
              {% if form.max_quantity_allowed.field.required %}
                (<span class="required">*</span>)
              {% endif %}
            </label>
            <div>{{form.max_quantity_allowed}}</div>
            <div class="error">{{ form.max_quantity_allowed.errors }}</div>
          </div>
          <div class="form-group col-md-6">
            <label for="id_{{form.available_quantity.name}}" class="form-label">
              {{ form.available_quantity.label|title }}
              {% if form.available_quantity.field.required %}
                (<span class="required">*</span>)
              {% endif %}
            </label>
            <div>{{form.available_quantity}}</div>
            <div class="error">{{ form.available_quantity.errors }}</div>
          </div>
        </div>
         <div class="row mb-3">
          <div class="form-group col-md-6">
            <label for="id_{{form.on_hold_quantity.name}}" class="form-label">
              {{ form.on_hold_quantity.label|title }}
              {% if form.on_hold_quantity.field.required %}
                (<span class="required">*</span>)
              {% endif %}
            </label>
            <div>{{form.on_hold_quantity}}</div>
            <div class="error">{{ form.on_hold_quantity.errors }}</div>
          </div>
          <div class="form-group col-md-6">
            <label for="id_{{form.given_quantity.name}}" class="form-label">
              {{ form.given_quantity.label|title }}
              {% if form.given_quantity.field.required %}
                (<span class="required">*</span>)
              {% endif %}
            </label>
            <div>{{form.given_quantity}}</div>
            <div class="error">{{ form.given_quantity.errors }}</div>
          </div>
        </div>

        <div class="form-group mb-3">
          <label for="id_{{form.status.name}}" class="form-label">
            {{ form.status.label }}
            {% if form.status.field.required %}
              (<span class="required">*</span>)
            {% endif %}
          </label>
          <div>{{form.status}}</div>
          <div class="error">{{ form.status.errors }}</div>
        </div>


        <div class="form-group" id="spinner">
          <img src="/static/img/page-loader.gif" class="icon"/>
        </div>
      </div>
      <div class="modal-footer">
        <div class="form-group buttons">
          <button type="submit" class="btn btn-success">
            Save
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
<script type="text/javascript">
  $(function (){

    $('#formGiveaway').submit(function(e){
      e.preventDefault();
      for (var instance in CKEDITOR.instances) {
        CKEDITOR.instances[instance].updateElement();
      }
      var formData = new FormData(this);
      $.ajax({
        type: $(this).attr('method'),
        url: this.action,
        data: formData,
        dataType: 'json',
        context: this,
        cache:false,
        contentType: false,
        processData: false,
        beforeSend: function(){
          $('#formGiveaway #spinner').show();
        },
        complete: function(){
          $('#formGiveaway #spinner').hide();
        },
        success: function(data, status) {
          console.log(status);
          if(data['success'] == true){
            console.log('success');
            $('#general').modal('toggle');
            location.reload();
          }
          else{
            $('#general').html(data['html']);
          }
        },
        error: function(){
          displayErrorDialog();
        }
      });
    });

  });
</script>

